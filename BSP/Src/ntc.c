#include "ntc.h"

#define NTCTabNum 121

//	MF52E 10K at 25    B = 3950    ADC = 12 bits
static uint16_t MF52E_tab[NTCTabNum]={

    980,/* 0 */
    1017,/* 1 */     1055,/* 2 */     1093,/* 3 */     1132,/* 3 */     1172,/* 5 */
    1213,/* 6 */     1254,/* 7 */     1295,/* 8 */     1337,/* 9 */     1380,/* 10 */
    1423,/* 11 */    1466,/* 12 */    1510,/* 13 */    1554,/* 14 */    1598,/* 15 */
    1643,/* 16 */    1688,/* 17 */    1733,/* 18 */    1778,/* 19 */    1823,/* 20 */
    1868,/* 21 */    1913,/* 22 */    1958,/* 23 */    2003,/* 24 */    2048,/* 25 */
    2092,/* 26 */    2136,/* 27 */    2180,/* 28 */    2224,/* 29 */    2267,/* 30 */
    2310,/* 31 */    2352,/* 32 */    2394,/* 33 */    2435,/* 34 */    2476,/* 35 */
    2517,/* 36 */    2556,/* 37 */    2595,/* 38 */    2634,/* 39 */    2672,/* 40 */
    2709,/* 41 */    2746,/* 42 */    2781,/* 43 */    2817,/* 44 */    2851,/* 45 */
    2885,/* 46 */    2918,/* 47 */    2950,/* 48 */    2982,/* 49 */    3013,/* 50 */
    3043,/* 51 */    3073,/* 52 */    3101,/* 53 */    3129,/* 54 */    3157,/* 55 */
    3183,/* 56 */    3209,/* 57 */    3235,/* 58 */    3259,/* 59 */    3283,/* 60 */
    3307,/* 61 */    3329,/* 62 */    3352,/* 63 */    3373,/* 64 */    3394,/* 65 */
    3414,/* 66 */    3434,/* 67 */    3453,/* 68 */    3471,/* 69 */    3489,/* 70 */
    3507,/* 71 */    3524,/* 72 */    3540,/* 73 */    3556,/* 74 */    3572,/* 75 */
    3587,/* 76 */    3601,/* 77 */    3615,/* 78 */    3629,/* 79 */    3642,/* 80 */
    3655,/* 81 */    3668,/* 82 */    3680,/* 83 */    3692,/* 84 */    3703,/* 85 */
    3714,/* 86 */    3724,/* 87 */    3734,/* 88 */    3744,/* 89 */    3754,/* 90 */
    3763,/* 91 */    3772,/* 92 */    3781,/* 93 */    3790,/* 94 */    3798,/* 95 */
    3806,/* 96 */    3814,/* 97 */    3822,/* 98 */    3829,/* 99 */    3836,/* 100 */
    3843,/* 101 */   3850,/* 102 */   3856,/* 103 */   3862,/* 104 */   3868,/* 105 */
    3874,/* 106 */   3880,/* 107 */   3886,/* 108 */   3892,/* 109 */   3897,/* 110 */
    3902,/* 111 */   3907,/* 112 */   3912,/* 113 */   3917,/* 114 */   3922,/* 115 */
    3927,/* 116 */   3931,/* 117 */   3935,/* 118 */   3940,/* 119 */   3944 /* 120 */
};



/**
 * @brief 查表 找到adc_val对应的temp
 *
 * @param[in] temp_tab 对照表
 * @param[in] tab_num 表元素个数
 * @param[in] adc_val adc_val
 * 
 * @return  temp
 * 
 * */

uint8_t LookupTable( uint16_t *temp_tab, uint8_t tab_num, uint16_t adc_val )
{
		uint8_t	i,temp_val = 0;
	
		for( i = 0; i < (tab_num-1); i++ )
		{
				if(( adc_val >= temp_tab[i] ) && ( adc_val < temp_tab[i+1]) )
				temp_val = i;	
		}
		return temp_val;
}

/**
 * @brief 取10次adc_val均值对应的temp
 *
 * @param[in] channle_x ntc通道1~6 
 * 
 * @return  temp :最终温度
 * 
 * */

uint16_t get_temp( uint8_t channle_x )
{
    uint8_t t;
    uint16_t adc_val = 0;
    uint16_t temp;

    /* 1, 取10次adc_val                           */
    for( t = 0; t < 10; t++ )
		{
			adc_val += Get_ADC12bitResult(channle_x);
      //printf("adc value is: %d \r\n",(int)adc_val);
		}	       
    adc_val = adc_val/10;

    /* 2, 查表，找到对应温度值                     */
    temp = LookupTable( MF52E_tab, NTCTabNum, adc_val );

    return temp;
}